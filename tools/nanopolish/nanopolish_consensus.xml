<tool id="nanopolish_consensus" name="Nanopolish consensus" version="0.7.2">

    <description>Re-call consensus from raw signal</description>

    <!-- ***************************************************************** -->
   
    <!--
    <requirements>
        <requirement type="package" version="0.7.2">nanopolish</requirement>
    </requirements>
    -->

    <!-- ***************************************************************** -->

    <version_command>nanopolish --version | perl -wnE'print "$1\n" for /^nanopolish version (.+)$/mg'</version_command>

    <!-- ***************************************************************** -->

    <command detect_errors="aggressive">
    <![CDATA[

    nanopolish consensus

        --reads   $input_reads
        --bam     $input_bam
        --genome  $input_ref
        --outfile $output
        --threads \${GALAXY_SLOTS:-1}

    ]]>
    </command>

    <!-- ***************************************************************** -->

    <inputs>

        <param name="input_reads" type="data" format="fasta" label="Input reads" />
        <param name="input_bam"   type="data" format="bam"   label="Alignment" />
        <param name="input_ref"   type="data" format="fasta" label="Reference" />

    </inputs>

    <!-- ***************************************************************** -->

    <outputs>

        <data name="output" format="fastq" label="${tool.name} on ${on_string} (reads.fastq)" />

    </outputs>

    <!-- ***************************************************************** -->

    <tests>
        <test>
            <param name="input" value="test_data.fast5.tar.gz" ftype="fast5_archive" />
            <output name="output" file="test_data.fastq" compare="sim_size" delta="0"/>
        </test>
    </tests>

    <!-- ***************************************************************** -->

    <help>
    <![CDATA[

**Description**

Nanopolish is a software package for signal-level analysis of Oxford Nanopore
sequencing data. Nanopolish can calculate an improved consensus sequence for a
draft genome assembly, detect base modifications, call SNPs and indels with
respect to a reference genome and more.

The Galaxy wrapper has modified nanopolish to take a gzip tarball of FAST5 reads
as input, such as can be produced by `poretools combine`, and always outputs a
single FASTQ file.

This is the `extract` module.

    ]]>
    </help>

    <!-- ***************************************************************** -->
    
    <citations>
    </citations>

</tool>
