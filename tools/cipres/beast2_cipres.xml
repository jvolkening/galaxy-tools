<tool id="beast2_cipres" name="Beast2" version="0.001" force_history_refresh="True">
  <description>Run BEASTv2 through the CIPRES service</description>
  <version_command>beast2 2> /dev/null | grep -e "v[0-9]\.*" | awk '{print $2}' | awk -F, '{print $1}' | sed 's/^.//'</version_command>
  <stdio>
    <exit_code range="1:"  level="fatal"   description="Job Runtime Error" />
    <exit_code range=":-1" level="fatal"   description="CIPRES submission error" />
  </stdio>
  <command interpreter="perl">
  <![CDATA[
    beast2_cipres.pl
      --in $input
      --runtime $runtime
      --user $__user_email__

      #if $seed.specify:
      --spec_seed 1
      --seed $seed.value
      #else
      --spec_seed 0
      #end if
      > $stdout
  ]]>
  </command>
  <inputs>
    <param format="xml" name="input" type="data" label="Input XML file" />
    <param name="runtime" size="4" type="float" value="0.5" label="Requested runtime (in hours)" />
    <conditional name="seed">
        <param name="specify" type="boolean" checked="no" truevalue="1" falsevalue="0" label="Specify seed (default: random)" />
        <when value="1">
            <param name="value" size="8" type="integer" value="12345" label="Seed value" />
        </when>
    </conditional>
  </inputs>
  <outputs>
    <data format="txt" name="stdout">
      <discover_datasets pattern="(?P&lt;designation&gt;.+\.trees)" visible="true" assign_primary_output="true" />
      <discover_datasets pattern="(?P&lt;designation&gt;.+\.log)" visible="true" />
    </data>
  </outputs>
  <help>

**Basic Usage**

This tool takes as input a BEAST2 XML file containing a multiple sequence
alignment and and analysis configuration. Typically this file is generated by
the BEAUti GUI. Most configuration options are included within the XML file --
however, you can also set a specific starting seed which allows you to
generate identical output from multiple runs if desired.

-----

**Runtime specification**

The CIPRES service requires that you request a specific "walltime" for each
job, which is the maximum amount of time that the job will be allowed to run
on the cluster. The default is 0.5 hours, which usually means your job will
run immediately but is probably not long enough for most jobs (or you wouldn't
be using CIPRES). Choose this value carefully - if your request is too short
your job may be killed before it completes, but if you ask for too much time
your job may sit in the queue for a long time waiting to be scheduled.

  </help>
  <citations>
    <citation type="doi">10.1371/journal.pcbi.1003537</citation>
  </citations>
</tool>
